# PomoTodo 実装計画

## プロジェクト概要

**アプリケーション名**: PomoTodo - ポモドーロタイマー統合型タスク管理アプリ  
**目的**: タスク管理とポモドーロテクニックを統合し、生産性を向上させる  
**実装方針**: HTML5, CSS3, Vanilla JavaScriptのみを使用し、フレームワーク不使用で実装

---

## ファイル構成

```
index.html          # メインHTMLファイル
app.js              # アプリケーションロジック
style.css           # スタイル定義
```

---

## 実装タスクチェックリスト

### 1. HTML構造の作成

- [✅️] index.html の基本構造を作成
- [✅️] ヘッダー部分（アプリ名、今日の統計表示）
- [✅️] メインレイアウト（2カラム：左タスクリスト、右タイマー）
- [✅️] タスクリストエリア（入力フォーム、リスト表示）
- [✅️] タイマー表示エリア（時間表示、進捗バー、操作ボタン）
- [✅️] フィルターボタン（全て/未完了/完了済み）
- [✅️] レスポンシブデザイン対応

### 2. CSSデザイン実装

- [✅️] ライトモードカラーパレット定義
- [✅️] ダークモードカラーパレット定義
- [✅️] レスポンシブレイアウト（デスクトップ、タブレット、モバイル）
- [✅️] ボタンスタイル（プライマリ、セカンダリ、危険）
- [✅️] 入力フィールドスタイル
- [✅️] タスクカードスタイル（通常、完了済み、選択中）
- [✅️] タイマー表示スタイル（作業中/休憩中で色分け）
- [✅️] アニメーション定義（fadeIn, fadeOut, pulse）
- [✅️] フォント指定とサイズ定義
- [✅️] アクセシビリティ対応スタイル（フォーカスインジケーター）

### 3. JavaScript基本構造

- [✅️] Taskクラス定義（id, title, completed, estimatedPomodoros, actualPomodoros, createdAt, completedAt）
- [✅️] Timerクラス定義（mode, duration, remainingTime, isRunning, isPaused, currentTaskId, startedAt, pomodoroCount）
- [✅️] Settingsクラス定義（workDuration, shortBreakDuration, longBreakDuration, longBreakInterval, notificationSound, focusMode, filterState）
- [✅️] データ管理オブジェクト（tasks, timer, settings）
- [✅️] DOM要素の参照を保持する変数定義

### 4. タスクリスト機能実装

#### 4.1 タスク追加機能
- [✅️] タスク入力フォームのイベントリスナー設定
- [✅️] Enterキー押下時の処理
- [✅️] 追加ボタンクリック時の処理
- [✅️] 空文字チェックとエラーメッセージ表示
- [✅️] 文字数制限（100文字）チェック
- [✅️] 入力フォームのクリア処理
- [✅️] 新タスクをリストの最上部に追加
- [✅️] 追加時のアニメーション効果

#### 4.2 タスク編集機能
- [✅️] タスク名ダブルクリック時のイベントリスナー
- [✅️] 編集モード表示（入力フィールド）
- [✅️] Enterキーで確定の処理
- [✅️] Escキーでキャンセルの処理
- [✅️] 編集中の他の操作制限
- [✅️] 空文字編集時のエラーハンドリング
- [✅️] 編集中にタイマー開始不可制限

#### 4.3 タスク削除機能
- [✅️] 削除ボタン（✕アイコン）追加
- [✅️] クリック時の即時削除処理
- [✅️] 削除時のフェードアウトアニメーション
- [✅️] タイマー実行中のタスク削除不可制限
- [✅️] 削除確認メッセージ表示

#### 4.4 タスク完了機能
- [✅️] チェックボックスのイベントリスナー
- [✅️] 完了状態時の視覚的変化（打ち消し線、背景色変更）
- [✅️] 完了タスクをリスト下部に移動（オプション）
- [✅️] 完了時のポモドーロ数記録
- [✅️] 状態変更時のLocalStoage保存

#### 4.5 タスクフィルタリング機能
- [✅️] フィルター状態管理（全て、未完了、完了済み）
- [✅️] フィルターボタンのイベントリスナー
- [✅️] フィルター切り替え時の表示更新
- [✅️] アクティブなフィルタのハイライト表示
- [✅️] フィルター状態のLocalStoage保存

### 5. ポモドーロタイマー機能実装

#### 5.1 タイマー基本構造
- [✅️] タイマーモード定義（作業中/短い休憩/長い休憩/停止中）
- [✅️] デフォルト時間設定（作業25分、短休憩5分、長休憩15分）
- [✅️] カスタマイズ可能時間範囲設定（作業1-60分、短休憩1-30分、長休憩5-60分）

#### 5.2 タイマー表示機能
- [✅️] 残り時間表示（MM:SS形式）
- [✅️] 進捗バー表示（円形または直線）
- [✅️] 現在モード表示（作業中/休憩中）
- [✅️] 現在実行中のタスク名表示
- [✅️] 大きく見やすいフォント設定（60px以上）
- [✅️] モード別色分け（作業中: 赤系、休憩中: 緑系）

#### 5.3 タイマー操作機能
- [✅️] 開始ボタンのイベントリスナーと処理
- [✅️] タスク未選択時のエラーチェック
- [✅️] 一時停止ボタンのイベントリスナーと処理
- [✅️] 再開ボタンのイベントリスナーと処理
- [✅️] リセットボタンのイベントリスナーと処理
- [✅️] 確認ダイアログ表示（リセット時）
- [✅️] スキップボタンのイベントリスナーと処理

#### 5.4 タイマー精度管理
- [✅️] setIntervalを使用した1秒ごとの更新
- [✅️] システム時刻を基準にしたドリフト補正
- [✅️] 25分タイマー±1秒以内の精度保証
- [✅️] バックグラウンドでも継続動作

#### 5.5 タイマー終了時処理
- [✅️] 音による通知（ピッ音×3回）
- [ ] ブラウザ通知（Notification API、許可された場合）
- [✅️] 視覚的通知（画面点滅またはモーダル）
- [✅️] 作業終了時の短い休憩への自動遷移
- [ ] 休憩終了時の次のタスク選択促し
- [✅️] 実績ポモドーロ数の+1更新
- [✅️] 今日の総ポモドーロ数の+1更新

#### 5.6 タイマー状態管理
- [✅️] 現在のモード保存
- [✅️] 残り時間保存
- [✅️] 開始時刻保存
- [✅️] 現在のタスクID保存
- [✅️] 今日の総ポモドーロ数保存
- [✅️] 完了ポモドーロタイムスタンプ保存
- [✅️] ページリロード時の状態復元
- [✅️] ブラウザクローズ時の状態保存

### 6. 統合機能実装

#### 6.1 タスク選択とタイマー連携
- [✅️] タスククリック時の選択状態変更
- [✅️] 選択中のタスクハイライト表示
- [✅️] 選択中のタスク名をタイマー画面に表示
- [✅️] 選択中のタスクの開始ボタン有効化
- [✅️] タイマー実行中のタスク選択不可制限

#### 6.2 ポモドーロ数カウントと表示
- [✅️] 各タスクに実績ポモドーロ数表示（例: 🍅 3/5）
- [✅️] タイマー画面に今日の総数表示（例: Today: 🍅 8）
- [✅️] タイマー終了時の自動更新
- [✅️] リアルタイム反映
- [✅️] 見積もり未達成: デフォルト色
- [✅️] 見積もり達成: 緑色
- [✅️] 見積もり超過: オレンジ色

#### 6.3 進捗可視化機能
- [ ] タスク単位の進捗バー表示（実績/見積もり）
- [ ] パーセント表示（60% 完了）
- [✅️] 日次統計表示（完了ポモドーロ数、完了タスク数、合計作業時間）
- [✅️] 連続ポモドーロ数（ストリーク）表示
- [✅️] 週次統計グラフ表示（過去7日間のポモドーロ数）

### 7. 高優先度追加機能

#### 7.1 タスク見積もりポモドーロ数設定
- [✅️] タスク追加時の見積もり入力欄追加（任意）
- [✅️] 1-20の範囲制限
- [✅️] デフォルト未設定設定
- [✅️] タスクに進捗表示（例: 0/5形式）

#### 7.2 今日の統計表示
- [✅️] 完了ポモドーロ数表示
- [✅️] 完了タスク数表示
- [✅️] 合計作業時間表示
- [✅️] 現在の連続ポモドーロ数表示
- [✅️] カード形式での表示
- [✅️] 数字を大きく目立つように表示
- [✅️] アイコン付き表示

#### 7.3 通知音カスタマイズ
- [✅️] ピッ音、ベル、チャイム、サイレントの選択肢
- [✅️] 設定画面からの選択機能
- [✅️] LocalStorageへの保存

### 8. 中優先度追加機能

#### 8.1 集中モード
- [✅️] タイマー実行中の操作制限
- [✅️] タスク追加/編集/削除不可設定
- [ ] 選択中以外のタスクを薄く表示
- [✅️] 設定画面でのON/OFF切り替え
- [✅️] デフォルトOFF設定

#### 8.2 週次統計グラフ
- [✅️] 過去7日間のポモドーロ数棒グラフ表示
- [✅️] 日別の完了タスク数表示
- [✅️] CSS+HTMLによる簡易グラフ実装

#### 8.3 タスク並び替え
- [✅️] ドラッグ&ドロップによる並び替え
- [ ] 上下移動ボタンによる並び替え
- [✅️] フィルタ適用中の並び替え不可制限

### 9. 低優先度追加機能

#### 9.1 タスク検索
- [✅️] 検索ボックス追加
- [✅️] リアルタイムフィルタリング
- [✅️] タスク名部分一致検索

#### 9.2 完了タスク一括削除
- [✅️] 「完了タスクを削除」ボタン追加
- [✅️] 確認ダイアログ表示
- [✅️] すべての完了タスク削除

#### 9.3 データのエクスポート/インポート
- [ ] JSON形式でのデータエクスポート機能
- [ ] JSONファイルからのデータインポート機能
- [ ] 既存データとのマージ機能

### 10. データ管理実装

#### 10.1 LocalStorage管理
- [✅️] pomotodo_tasks キーでタスク配列保存
- [✅️] pomotodo_timer キーでタイマー情報保存
- [✅️] pomotodo_settings キーで設定情報保存
- [ ] pomotodo_today キーで今日の日付保存
- [ ] pomotodo_history キーでポモドーロ履歴保存

#### 10.2 データ永続化
- [✅️] タスク追加/編集/削除/完了時の即時保存
- [✅️] タイマー状態変更時の即時保存
- [✅️] 設定変更時の即時保存
- [✅️] LocalStorage容量不足時のエラーハンドリング
- [✅️] LocalStorage無効時のエラーハンドリング

### 11. セキュリティ実装

#### 11.1 XSS対策
- [✅️] ユーザー入力のエスケープ処理
- [✅️] innerHTML使用時の注意
- [✅️] textContent/createTextNodeの優先使用

#### 11.2 データ検証
- [✅️] タスク名100文字以内制限
- [✅️] 見積もりポモドーロ数1-20制限
- [ ] タイマー時間1-60分制限
- [✅️] エラーハンドリング（try-catchでLocalStorageエラー）

### 12. アクセシビリティ実装

#### 12.1 キーボード操作対応
- [ ] Tab/Shift+Tabによるフォーカス移動
- [✅️] Enterによるボタンクリック、タスク追加
- [ ] Spaceによるチェックボックストグル
- [ ] Escapeによるモーダル、ダイアログ閉じる

#### 12.2 スクリーンリーダー対応
- [✅️] 適切なARIA属性の使用（role, aria-label, aria-live）
- [✅️] セマンティックHTMLの使用
- [ ] 明確なフォーカススタイル

#### 12.3 色覚対応
- [ ] 色だけに依存しない情報伝達
- [ ] 十分なコントラスト比（WCAG AA準拠）

### 13. パフォーマンス最適化

#### 13.1 応答時間最適化
- [ ] ボタンクリック→反映（100ms以内）
- [ ] タスク追加/削除（200ms以内）
- [ ] フィルタ切り替え（100ms以内）

#### 13.2 メモリ使用量管理
- [ ] タスク100件時の5MB以下制限
- [ ] メモリリーク防止（イベントリスナーの適切な削除）

### 14. エラーハンドリング

#### 14.1 入力エラー
- [✅️] 空文字入力エラー（E001: "タスク名を入力してください"）
- [✅️] 文字数超過エラー（E002: "タスク名は100文字以内で入力してください"）
- [✅️] タスク未選択エラー（E003: "タスクを選択してください"）
- [✅️] タイマー中タスク削除エラー（E004: "タイマーを停止してから削除してください"）
- [✅️] 編集中他操作エラー（E008: "編集を完了してください"）

#### 14.2 データエラー
- [✅️] LocalStorage容量不足（E005: "保存容量が不足しています"）
- [✅️] LocalStorage無効（E006: "データの保存ができません"）
- [✅️] リセット確認（E007: "タイマーをリセットしますか？"）

### 15. テストと検証

#### 15.1 機能テスト
- [ ] 全ての基本機能が正常に動作することを確認
- [ ] エラーハンドリングが適切に動作することを確認
- [ ] タイマー精度が±1秒以内であることを確認
- [ ] ページリロード後の状態復元を確認

#### 15.2 UXテスト
- [ ] レスポンシブデザインが各デバイスで正しく動作
- [ ] アニメーションが滑らかに表示
- [ ] キーボード操作がすべての機能で可能
- [ ] 視覚的フィードバックが適切に表示

---

## 実装優先順位

1. **必須機能（実装必須）**
   - タスクの追加、編集、削除、完了
   - ポモドーロタイマー（作業/休憩切り替え）
   - データ永続化（LocalStorage）
   - タスク選択とタイマー連携

2. **高優先度追加機能**
   - 今日の統計表示
   - 通知音カスタマイズ
   - ポモドーロ数表示

3. **中優先度追加機能**
   - 集中モード
   - 週次統計グラフ
   - タスク並び替え

4. **低優先度追加機能**
   - タスク検索
   - 完了タスク一括削除
   - データエクスポート/インポート