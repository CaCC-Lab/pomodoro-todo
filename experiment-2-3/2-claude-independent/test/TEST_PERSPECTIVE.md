# PomoTodoアプリケーション テスト観点表

## テスト戦略
- **等価分割法**: 入力を同じ振る舞いをする等価クラスに分割
- **境界値分析**: 境界値（最小値、最大値、±1）をテスト
- **失敗系**: 正常系と同数以上の失敗系テストを含める

---

## 1. ユーティリティ関数

### 1.1 sanitizeInput()

| テストID | 分類 | 入力値 | 期待値 | 備考 |
|---------|------|--------|--------|------|
| U1-1 | 正常系 | 通常文字列 "test" | "test" | 通常の入力 |
| U1-2 | 正常系 | 空文字列 "" | "" | 境界値 |
| U1-3 | 異常系 | HTMLタグ `<script>alert('XSS')</script>` | エスケープされた文字列 | XSS対策 |
| U1-4 | 異常系 | HTMLエンティティ `&lt;div&gt;` | `&amp;lt;div&amp;gt;` | エンティティのエスケープ |
| U1-5 | 境界値 | 特殊文字 `<>&"'` | エスケープされた文字列 | 境界値 |

### 1.2 validateTaskTitle()

| テストID | 分類 | 入力値 | 期待値 | 備考 |
|---------|------|--------|--------|------|
| U2-1 | 正常系 | 通常文字列 "テスト" | null | エラーなし |
| U2-2 | 正常系 | 100文字 | null | 境界値（最大） |
| U2-3 | 異常系 | 空文字列 "" | エラーメッセージ | 必須項目 |
| U2-4 | 異常系 | 空白のみ "   " | エラーメッセージ | trim後空 |
| U2-5 | 異常系 | 101文字 | エラーメッセージ | 境界値（最大+1） |
| U2-6 | 境界値 | 99文字 | null | 境界値（最大-1） |
| U2-7 | 異常系 | null | エラーメッセージ | 不正な型 |
| U2-8 | 異常系 | undefined | エラーメッセージ | 不正な型 |

### 1.3 formatTime()

| テストID | 分類 | 入力値（秒） | 期待値 | 備考 |
|---------|------|-------------|--------|------|
| U3-1 | 正常系 | 0 | "00:00" | 境界値（最小） |
| U3-2 | 正常系 | 59 | "00:59" | 境界値（秒最大） |
| U3-3 | 正常系 | 60 | "01:00" | 境界値（1分） |
| U3-4 | 正常系 | 61 | "01:01" | 境界値（1分+1秒） |
| U3-5 | 正常系 | 1500 | "25:00" | 25分（デフォルト作業時間） |
| U3-6 | 正常系 | 3599 | "59:59" | 境界値（時間表示なし最大） |
| U3-7 | 正常系 | 3600 | "60:00" | 1時間 |
| U3-8 | 異常系 | -1 | 不正な出力 | 負の値 |
| U3-9 | 異常系 | "string" | エラーまたは不正な出力 | 不正な型 |
| U3-10 | 異常系 | null | エラーまたは不正な出力 | 不正な型 |

---

## 2. LocalStorage操作

### 2.1 saveToStorage()

| テストID | 分類 | 入力 | 期待値 | 備考 |
|---------|------|------|--------|------|
| S1-1 | 正常系 | 通常オブジェクト | localStorage保存成功 | 正常保存 |
| S1-2 | 正常系 | 空配列 [] | localStorage保存成功 | 境界値 |
| S1-3 | 正常系 | null | localStorage保存成功 | null値 |
| S1-4 | 異常系 | QuotaExceededError | エラーメッセージ表示 | 容量超過 |
| S1-5 | 異常系 | 一般エラー | エラーメッセージ表示 | その他エラー |
| S1-6 | 異常系 | 循環参照オブジェクト | エラー | JSON.stringify失敗 |

### 2.2 loadFromStorage()

| テストID | 分類 | 保存データ | デフォルト値 | 期待値 | 備考 |
|---------|------|-----------|------------|--------|------|
| S2-1 | 正常系 | 有効なJSON | - | パースされたオブジェクト | 正常読み込み |
| S2-2 | 正常系 | null | {} | {} | データなし |
| S2-3 | 異常系 | 不正なJSON | [] | [] | パースエラー時デフォルト |
| S2-4 | 異常系 | undefined | "default" | "default" | 未定義時デフォルト |

---

## 3. タスク管理

### 3.1 createTask()

| テストID | 分類 | タイトル | 見積もり | 期待結果 | 備考 |
|---------|------|---------|---------|---------|------|
| T1-1 | 正常系 | "テスト" | 5 | タスクオブジェクト生成 | 通常生成 |
| T1-2 | 正常系 | "テスト" | null | タスクオブジェクト生成 | 見積もりなし |
| T1-3 | 正常系 | "テスト" | 0 | タスクオブジェクト生成 | 境界値（見積もり最小） |
| T1-4 | 正常系 | "テスト" | 20 | タスクオブジェクト生成 | 境界値（見積もり最大） |
| T1-5 | 正常系 | `<script>` | 5 | サニタイズされたタスク | XSS対策 |
| T1-6 | 境界値 | 100文字タイトル | 5 | タスクオブジェクト生成 | 境界値（最大長） |

### 3.2 addTask()

| テストID | 分類 | タイトル | 見積もり | 期待結果 | 備考 |
|---------|------|---------|---------|---------|------|
| T2-1 | 正常系 | "テスト" | 5 | タスク追加成功 | 通常追加 |
| T2-2 | 正常系 | "テスト" | null | タスク追加成功 | 見積もりなし |
| T2-3 | 異常系 | "" | 5 | エラーメッセージ表示 | 空文字列 |
| T2-4 | 異常系 | "   " | 5 | エラーメッセージ表示 | 空白のみ |
| T2-5 | 異常系 | 101文字 | 5 | エラーメッセージ表示 | 境界値超過 |
| T2-6 | 境界値 | 100文字 | 5 | タスク追加成功 | 境界値（最大） |
| T2-7 | 境界値 | 99文字 | 5 | タスク追加成功 | 境界値（最大-1） |

### 3.3 deleteTask()

| テストID | 分類 | 前提条件 | タスクID | 期待結果 | 備考 |
|---------|------|---------|---------|---------|------|
| T3-1 | 正常系 | タスク存在 | 存在するID | タスク削除成功 | 通常削除 |
| T3-2 | 異常系 | タイマー実行中 | 実行中タスクID | エラーメッセージ | タイマー実行中は削除不可 |
| T3-3 | 異常系 | タスク不在 | 存在しないID | エラーなし（無視） | 存在しないIDの削除 |
| T3-4 | 境界値 | 複数タスク | 最初のタスクID | 削除成功 | 最初の要素 |
| T3-5 | 境界値 | 複数タスク | 最後のタスクID | 削除成功 | 最後の要素 |

### 3.4 toggleTaskComplete()

| テストID | 分類 | 前提条件 | タスクID | 期待結果 | 備考 |
|---------|------|---------|---------|---------|------|
| T4-1 | 正常系 | 未完了タスク | 存在するID | completed=true | 完了に切り替え |
| T4-2 | 正常系 | 完了タスク | 存在するID | completed=false | 未完了に切り替え |
| T4-3 | 正常系 | 未完了タスク | 存在するID | completedAt設定 | タイムスタンプ記録 |
| T4-4 | 正常系 | 完了タスク | 存在するID | completedAt=null | タイムスタンプクリア |
| T4-5 | 異常系 | タスク不在 | 存在しないID | エラーなし（無視） | 存在しないIDの処理 |

### 3.5 selectTask()

| テストID | 分類 | 前提条件 | タスクID | 期待結果 | 備考 |
|---------|------|---------|---------|---------|------|
| T5-1 | 正常系 | タイマー停止中 | 存在するID | タスク選択成功 | 通常選択 |
| T5-2 | 異常系 | タイマー実行中 | 任意のID | エラーメッセージ | タイマー実行中は選択不可 |
| T5-3 | 異常系 | タイマー停止中 | 存在しないID | 選択は成功（エラーなし） | 存在しないIDでも選択可 |
| T5-4 | 正常系 | タスク選択済み | 別のID | 選択切り替え成功 | 選択の切り替え |

### 3.6 getFilteredTasks()

| テストID | 分類 | フィルタ状態 | タスクリスト | 期待結果 | 備考 |
|---------|------|------------|------------|---------|------|
| T6-1 | 正常系 | 'all' | 混在リスト | 全タスク返却 | すべて表示 |
| T6-2 | 正常系 | 'active' | 混在リスト | 未完了タスクのみ | 未完了のみ |
| T6-3 | 正常系 | 'completed' | 混在リスト | 完了タスクのみ | 完了のみ |
| T6-4 | 境界値 | 'all' | 空配列 | 空配列 | タスクなし |
| T6-5 | 境界値 | 'active' | 全完了リスト | 空配列 | フィルタ結果0件 |
| T6-6 | 境界値 | 'completed' | 全未完了リスト | 空配列 | フィルタ結果0件 |

### 3.7 setFilter()

| テストID | 分類 | フィルタ値 | 期待結果 | 備考 |
|---------|------|----------|---------|------|
| T7-1 | 正常系 | 'all' | フィルタ設定成功 | すべて表示 |
| T7-2 | 正常系 | 'active' | フィルタ設定成功 | 未完了表示 |
| T7-3 | 正常系 | 'completed' | フィルタ設定成功 | 完了表示 |
| T7-4 | 異常系 | 'invalid' | デフォルト動作 | 不正な値 |
| T7-5 | 異常系 | null | エラーまたはデフォルト | 不正な型 |

---

## 4. タイマー機能

### 4.1 startTimer()

| テストID | 分類 | 前提条件 | 期待結果 | 備考 |
|---------|------|---------|---------|------|
| TM1-1 | 正常系 | タスク選択済み、停止中 | タイマー開始 | 通常開始 |
| TM1-2 | 正常系 | タスク選択済み、一時停止中 | タイマー再開 | 一時停止から再開 |
| TM1-3 | 異常系 | タスク未選択 | エラーメッセージ | タスク未選択エラー |
| TM1-4 | 境界値 | タスク選択直後 | タイマー開始 | 初期状態からの開始 |

### 4.2 pauseTimer()

| テストID | 分類 | 前提条件 | 期待結果 | 備考 |
|---------|------|---------|---------|------|
| TM2-1 | 正常系 | タイマー実行中 | タイマー一時停止 | 通常一時停止 |
| TM2-2 | 正常系 | タイマー実行中 | remainingTime保持 | 残り時間保存 |
| TM2-3 | 境界値 | タイマー開始直後 | タイマー一時停止 | 開始直後の停止 |

### 4.3 resetTimer()

| テストID | 分類 | 前提条件 | 期待結果 | 備考 |
|---------|------|---------|---------|------|
| TM3-1 | 正常系 | タイマー実行中、確認OK | タイマーリセット | 確認後リセット |
| TM3-2 | 正常系 | タイマー一時停止中、確認OK | タイマーリセット | 一時停止からリセット |
| TM3-3 | 正常系 | タイマー停止中 | タイマーリセット | 確認なしでリセット |
| TM3-4 | 境界値 | タイマー実行中、確認Cancel | リセット中止 | 確認拒否 |

### 4.4 skipTimer()

| テストID | 分類 | 現在のモード | 期待結果 | 備考 |
|---------|------|------------|---------|------|
| TM4-1 | 正常系 | 'work' | 'shortBreak'に遷移 | 作業からショートブレーク |
| TM4-2 | 正常系 | 'shortBreak' | 'work'に遷移 | ショートブレークから作業 |
| TM4-3 | 正常系 | 'longBreak' | 'work'に遷移 | ロングブレークから作業 |
| TM4-4 | 境界値 | 'idle' | 状態変更 | アイドル状態からのスキップ |

### 4.5 tick()

| テストID | 分類 | remainingTime | isRunning | 期待結果 | 備考 |
|---------|------|--------------|-----------|---------|------|
| TM5-1 | 正常系 | 60 | true | remainingTime=59 | 通常のtick |
| TM5-2 | 境界値 | 1 | true | onTimerComplete呼び出し | 完了直前 |
| TM5-3 | 境界値 | 0 | true | onTimerComplete呼び出し | 完了時 |
| TM5-4 | 異常系 | 60 | false | 処理なし | 停止中のtick |
| TM5-5 | 境界値 | -1 | true | onTimerComplete呼び出し | 負の値（バグケース） |

### 4.6 onTimerComplete()

| テストID | 分類 | モード | pomodoroCount | 期待結果 | 備考 |
|---------|------|-------|--------------|---------|------|
| TM6-1 | 正常系 | 'work' | 0 | actualPomodoros+1, 'shortBreak'遷移 | 作業完了→ショートブレーク |
| TM6-2 | 正常系 | 'work' | 3 | actualPomodoros+1, 'longBreak'遷移 | 4回目完了→ロングブレーク |
| TM6-3 | 正常系 | 'shortBreak' | 1 | 'work'遷移 | ショートブレーク完了→作業 |
| TM6-4 | 正常系 | 'longBreak' | 4 | 'work'遷移 | ロングブレーク完了→作業 |
| TM6-5 | 境界値 | 'work' | 0 | pomodoroCount=1 | 初回完了 |
| TM6-6 | 境界値 | 'work' | 7 | pomodoroCount=8, 'longBreak'遷移 | 8回目（2サイクル目） |

---

## 5. 統計・日付管理

### 5.1 updateStats()

| テストID | 分類 | タスク状態 | pomodoroCount | 期待結果 | 備考 |
|---------|------|-----------|--------------|---------|------|
| ST1-1 | 正常系 | 完了0件 | 0 | 適切な統計表示 | 初期状態 |
| ST1-2 | 正常系 | 完了3件 | 5 | 適切な統計表示 | 通常の統計 |
| ST1-3 | 境界値 | 完了0件 | 0 | "0h 0m" | ゼロ表示 |
| ST1-4 | 境界値 | 完了100件 | 100 | "41h 40m" | 大きな値 |

### 5.2 checkDateChange()

| テストID | 分類 | 保存日付 | 現在日付 | 期待結果 | 備考 |
|---------|------|---------|---------|---------|------|
| ST2-1 | 正常系 | 今日 | 今日 | リセットなし | 同日 |
| ST2-2 | 正常系 | 昨日 | 今日 | pomodoroCount=0 | 日付変更 |
| ST2-3 | 境界値 | null | 今日 | 初期化 | 初回起動 |
| ST2-4 | 境界値 | 1週間前 | 今日 | pomodoroCount=0 | 長期間経過 |

---

## 6. DOM操作・UI（モック必須）

### 6.1 renderTasks()

| テストID | 分類 | タスクリスト | フィルタ | 期待結果 | 備考 |
|---------|------|------------|---------|---------|------|
| UI1-1 | 正常系 | タスク3件 | 'all' | 3件表示 | 通常表示 |
| UI1-2 | 正常系 | タスク3件 | 'active' | 未完了のみ表示 | フィルタ適用 |
| UI1-3 | 境界値 | 空配列 | 'all' | 何も表示されない | タスクなし |
| UI1-4 | 境界値 | タスク100件 | 'all' | 100件表示 | 大量タスク |

### 6.2 updateTimerDisplay()

| テストID | 分類 | タイマー状態 | 期待結果 | 備考 |
|---------|------|------------|---------|------|
| UI2-1 | 正常系 | mode='work', remainingTime=1500 | "25:00"表示 | 作業時間表示 |
| UI2-2 | 正常系 | mode='shortBreak' | "短い休憩"表示 | ショートブレーク表示 |
| UI2-3 | 正常系 | mode='longBreak' | "長い休憩"表示 | ロングブレーク表示 |
| UI2-4 | 正常系 | mode='idle' | "待機中"表示 | アイドル表示 |
| UI2-5 | 境界値 | isRunning=true | runningクラス付与 | アニメーション表示 |

---

## 7. エッジケース・例外系

| テストID | 分類 | シナリオ | 期待結果 | 備考 |
|---------|------|---------|---------|------|
| E1 | 例外 | localStorage無効 | エラーメッセージ表示 | プライベートモード等 |
| E2 | 例外 | localStorage容量超過 | エラーメッセージ表示 | QuotaExceededError |
| E3 | 例外 | 不正なJSON読み込み | デフォルト値使用 | データ破損 |
| E4 | 例外 | DOM要素が存在しない | エラーまたはグレースフルデグラデーション | 初期化失敗 |
| E5 | 例外 | 通知APIが利用不可 | エラーなし（無視） | 古いブラウザ |
| E6 | 例外 | AudioContextが利用不可 | エラーなし（無視） | 音声再生失敗 |
| E7 | 境界値 | タイマー実行中にページリロード | 停止状態で復元 | 状態復元 |
| E8 | 境界値 | 複数タブで同時操作 | 最後の操作が保存される | 競合状態 |

---

## テストカバレッジ目標

- **分岐網羅率**: 100%
- **正常系/異常系比率**: 異常系 ≥ 正常系
- **境界値テスト**: 各関数で最小値、最大値、±1をテスト
- **型チェック**: null, undefined, 不正な型の入力をテスト
- **外部依存**: localStorage, DOM, Web API のモック化

---

## テスト実装優先順位

1. **高**: ユーティリティ関数（sanitize, validate, formatTime）
2. **高**: タスク管理（CRUD操作）
3. **高**: タイマー機能（状態遷移、時間計算）
4. **中**: LocalStorage操作
5. **中**: 統計・日付管理
6. **低**: DOM操作・UI（手動テストも可）

---

## テスト環境

- **フレームワーク**: Jest
- **カバレッジツール**: Jest内蔵の istanbul
- **モック**: jest.fn(), jest.spyOn()
- **DOM環境**: jsdom
