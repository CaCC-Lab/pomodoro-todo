# PomoTodo 実装計画（Cursor Independent）

## ゴール
- 要件定義書の必須機能および高優先度追加機能を、HTML/CSS/Vanilla JS のみで実装する。
- LocalStorage を利用した完全クライアントサイド動作とし、再読み込み時も状態が復元される。
- UI/UX・非機能要件（パフォーマンス、アクセシビリティ、セキュリティ）を満たした実装を提供する。

## フェーズ進捗サマリー
- [x] フェーズA: プロジェクト基盤とストラクチャ整備
- [x] フェーズB: データモデル・状態管理の実装
- [x] フェーズC: Todoリスト必須機能開発
- [ ] フェーズD: ポモドーロタイマー機能開発
- [ ] フェーズE: Todo×タイマー統合機能実装
- [ ] フェーズF: UI/UX・アニメーション・レスポンシブ対応
- [ ] フェーズG: 非機能要件・アクセシビリティ対応
- [ ] フェーズH: 検証・テスト・ドキュメント整備
- [ ] フェーズI: 追加機能（優先度順）

---

## フェーズA: プロジェクト基盤とストラクチャ整備
- [x] 開発用ディレクトリ整理（`index.html` / `style.css` / `app.js` の 3 ファイル構成を確認）
- [x] HTML ベースレイアウトの骨組みマークアップ（ヘッダー、主要セクションの div/nav/section）
- [x] CSS リセットもしくは初期化スタイル（最小限）を定義
- [x] 共通 CSS 変数（カラースキーム、フォントサイズ、スペーシング）を `:root` に設定
- [x] JavaScript エントリポイントに即時関数またはモジュール風構造を作成し、グローバル汚染を防止

- [x] `Task` / `Timer` / `Settings` それぞれのデータ構造を定義（工場関数 or クラス）
- [x] LocalStorage ラッパーモジュール（保存・読込・例外処理・バージョン管理）を実装
- [x] 日付判定と日次リセット処理（`pomotodo_today` / `pomotodo_history`）を実装
- [x] アプリケーション状態（タスクリスト、選択タスク、タイマー状態、設定）を集中管理するステート管理モジュールを用意
- [x] 状態変更イベントの購読仕組み（シンプルな pub/sub もしくはコールバック管理）を準備

- [x] タスク追加フォーム実装（入力検証、エラーメッセージ表示、アニメーション）
- [x] タスクリスト描画ロジック（未完了/完了のリアルタイム反映、選択ハイライト）
- [x] タスク編集モード（ダブルクリック → 編集フォーム、Enter 確定 / Esc 取消）
- [x] タスク削除処理（タイマー実行中はブロック、フェードアウトアニメーション）
- [x] 完了チェックのトグル（UI 更新、完了日時更新、リスト内並び替え）
- [x] フィルタリング制御（全て/未完了/完了、アクティブ状態保存）
- [x] タスク操作時の LocalStorage 同期（add/edit/delete/toggle/filter）

## フェーズD: ポモドーロタイマー機能開発
- [ ] タイマー設定値のロード/保存（デフォルト 25/5/15、1-60 分範囲チェック）
- [ ] タイマー UI（モード表示、残り時間、進捗バー、選択タスク名表示）
- [ ] タイマー制御ロジック（開始／再開／一時停止／リセット／スキップ）
- [ ] setInterval + 実時間差分によるドリフト対策ロジックを実装
- [ ] タイマー状態の永続化（残り秒数、開始時刻、モード、実行フラグ）
- [ ] タイマー終了時処理（通知音、ブラウザ通知、視覚効果、自動モード遷移）

## フェーズE: Todo×タイマー統合機能実装
- [ ] タスク選択とタイマー開始の連動（未選択時エラー、実行中は選択ロック）
- [ ] タイマー完了時にタスクの実績ポモドーロ数を加算
- [ ] 実績/見積もり表示更新（色分け、アイコン表示、プログレスバー）
- [ ] 今日の統計（ポモドーロ数・完了タスク数・累計時間）のリアルタイム更新
- [ ] 長い休憩提案（設定されたインターバルごとに自動切替または通知）

## フェーズF: UI/UX・アニメーション・レスポンシブ対応
- [ ] レイアウト: デスクトップ 2 カラム（40/60）、タブレット（45/55）、モバイル縦並び or タブ切替
- [ ] タイマー視認性（60px 以上のフォント、色変化、進捗バーアニメーション）
- [ ] タスクカードデザイン（ホバー、選択、完了解除時のスタイル）
- [ ] ボタン・入力フィールドのスタイルと状態変化（hover, active, disabled, error）
- [ ] タスク追加/削除/完了時のアニメーション（fadeIn/fadeOut/pulse）
- [ ] ダークモード対応（`prefers-color-scheme`）

## フェーズG: 非機能要件・アクセシビリティ対応
- [ ] パフォーマンス計測と最適化（DOM 更新バッチ処理、再描画最小化）
- [ ] メモリリーク対策（不要なイベントリスナー解除、Interval クリーンアップ）
- [ ] XSS 対策（`textContent` / `createTextNode` の徹底、入力サニタイズ）
- [ ] 入力バリデーション（境界値チェック、ユーザーフィードバック）
- [ ] ARIA 属性・セマンティック HTML の適用（`aria-live`、`role="status"` 等）
- [ ] キーボード操作サポート（Tab 順序、Enter/Space/Escape 対応、フォーカスリング）
- [ ] コントラストと色依存の回避（WCAG AA 指標確認）

## フェーズH: 検証・テスト・ドキュメント整備
- [ ] 手動テストシナリオ作成（必須機能、エッジケース、エラー表示）
- [ ] タイマー精度検証（25 分 / 5 分で ±1 秒以内）
- [ ] LocalStorage 異常時テスト（容量オーバー、無効化時のメッセージ確認）
- [ ] 主要ブラウザでの互換性確認（Chrome / Firefox / Safari / Edge）
- [ ] README or 利用ガイド更新（使い方、制約、既知の制限）
- [ ] 実装計画に対する進捗チェックと未完タスクの整理

## フェーズI: 追加機能（優先度順で可能な範囲）
### 高優先度
- [ ] タスク見積もりポモドーロ数入力・表示強化（`🍅 実績/見積もり`）
- [ ] 今日の統計カード（ストリーク、合計時間表示）
- [ ] 通知音のカスタマイズ（選択 UI、音源管理、設定保持）

### 中優先度
- [ ] 集中モード切替（設定項目、UI ロック、視覚フィードバック）
- [ ] 週次統計グラフ（過去 7 日の棒グラフ、CSS/HTML 実装）
- [ ] タスク並び替え（Drag & Drop または上下ボタン、フィルタ中は無効化）

### 低優先度
- [ ] タスク検索（リアルタイムフィルタ、キーボード対応）
- [ ] 完了タスク一括削除（確認ダイアログ、タイマー連動制約）
- [ ] データエクスポート/インポート（JSON 生成・読み込み・マージ）

---

## 依存関係とリスクメモ
- フェーズBで状態管理基盤を整えないと、フェーズC〜Eの連携実装が冗長化する → 最優先で完了させる。
- タイマーと統計機能は LocalStorage データ仕様に強く依存するため、データスキーマ変更時は移行処理を検討する。
- ブラウザ通知・音声再生はユーザー許可や自動再生制限に影響されるため、フェールセーフメッセージを用意する。
- パフォーマンス要件（100ms 応答）を満たすため、DOM 更新のバッチ処理と requestAnimationFrame 活用を検討。

## 完了判定チェック
- [ ] フェーズA〜H の必須タスク完了、I で合意した追加機能を実装
- [ ] 手動テスト結果が要件の評価基準を満たしている
- [ ] 非機能要件（パフォーマンス、アクセシビリティ、セキュリティ）に関する確認記録が残っている
- [ ] ドキュメント（README/実装メモ/既知の問題）が最新化されている
