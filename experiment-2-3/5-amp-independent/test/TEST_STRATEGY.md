# テスト観点表 - PomoTodo アプリケーション

## 目次
1. [Utils関数](#utils関数)
2. [Taskクラス](#taskクラス)
3. [Timerクラス](#timerクラス)
4. [Statisticsクラス](#statisticsクラス)
5. [StorageManagerクラス](#storagemanagerクラス)
6. [TodoControllerクラス](#todocontrollerクラス)
7. [TimerControllerクラス](#timercontrollerクラス)

---

## Utils関数

### 1. generateUUID()

| 観点 | テストケース | 入力 | 期待値 | 分類 |
|------|-------------|------|--------|------|
| 正常系 | UUID形式の検証 | - | `xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx`形式 | 正常 |
| 正常系 | 一意性の検証 | 10000回生成 | すべて異なる値 | 正常 |
| 正常系 | 長さの検証 | - | 36文字（ハイフン含む） | 正常 |
| 境界値 | 連続呼び出し | 連続10000回 | すべて成功 | 境界値 |

### 2. formatTime(seconds)

| 観点 | テストケース | 入力 | 期待値 | 分類 |
|------|-------------|------|--------|------|
| 正常系 | 25分 | 1500 | "25:00" | 正常 |
| 正常系 | 1分 | 60 | "01:00" | 正常 |
| 正常系 | 1分1秒 | 61 | "01:01" | 正常 |
| 境界値 | 0秒 | 0 | "00:00" | 境界値 |
| 境界値 | 1秒 | 1 | "00:01" | 境界値 |
| 境界値 | 59秒 | 59 | "00:59" | 境界値 |
| 境界値 | 60秒 | 60 | "01:00" | 境界値 |
| 境界値 | 99分59秒 | 5999 | "99:59" | 境界値 |
| 異常系 | 負の値 | -1 | "00:00" or エラー | 異常 |
| 異常系 | 小数 | 1.5 | "00:01" | 異常 |
| 異常系 | 文字列 | "abc" | エラー or NaN処理 | 異常 |
| 異常系 | null | null | エラー | 異常 |
| 異常系 | undefined | undefined | エラー | 異常 |
| 異常系 | オブジェクト | {} | エラー | 異常 |

### 3. isToday(dateString)

| 観点 | テストケース | 入力 | 期待値 | 分類 |
|------|-------------|------|--------|------|
| 正常系 | 今日の日付 | 今日のISO文字列 | true | 正常 |
| 正常系 | 昨日の日付 | 昨日のISO文字列 | false | 正常 |
| 正常系 | 明日の日付 | 明日のISO文字列 | false | 正常 |
| 境界値 | 今日0時0分0秒 | 今日00:00:00 | true | 境界値 |
| 境界値 | 今日23時59分59秒 | 今日23:59:59 | true | 境界値 |
| 異常系 | 不正な日付文字列 | "invalid" | false or エラー | 異常 |
| 異常系 | 空文字列 | "" | false or エラー | 異常 |
| 異常系 | null | null | エラー | 異常 |
| 異常系 | undefined | undefined | エラー | 異常 |

### 4. sanitize(text)

| 観点 | テストケース | 入力 | 期待値 | 分類 |
|------|-------------|------|--------|------|
| 正常系 | 通常のテキスト | "Hello World" | "Hello World" | 正常 |
| 正常系 | HTMLタグを含む | "&lt;script&gt;alert('XSS')&lt;/script&gt;" | エスケープされたHTML | 正常 |
| 正常系 | 特殊文字 | "&lt;&gt;&amp;&quot;" | エスケープされた文字 | 正常 |
| 境界値 | 空文字列 | "" | "" | 境界値 |
| 異常系 | null | null | エラー | 異常 |
| 異常系 | undefined | undefined | エラー | 異常 |
| 異常系 | オブジェクト | {} | "[object Object]" | 異常 |

---

## Taskクラス

### コンストラクタ

| 観点 | テストケース | 入力 | 期待値 | 分類 |
|------|-------------|------|--------|------|
| 正常系 | タイトルのみ | "タスク1" | estimatedPomodoros=0 | 正常 |
| 正常系 | タイトルと見積もり | "タスク1", 5 | estimatedPomodoros=5 | 正常 |
| 境界値 | 見積もり0 | "タスク", 0 | estimatedPomodoros=0 | 境界値 |
| 境界値 | 見積もり1 | "タスク", 1 | estimatedPomodoros=1 | 境界値 |
| 境界値 | 見積もり20 | "タスク", 20 | estimatedPomodoros=20 | 境界値 |
| 異常系 | 見積もり負の値 | "タスク", -1 | -1がセットされる（要バリデーション） | 異常 |
| 異常系 | 見積もり21以上 | "タスク", 21 | 21がセットされる（要バリデーション） | 異常 |

### toggleComplete()

| 観点 | テストケース | 入力 | 期待値 | 分類 |
|------|-------------|------|--------|------|
| 正常系 | 未完了→完了 | completed=false | completed=true, completedAt設定 | 正常 |
| 正常系 | 完了→未完了 | completed=true | completed=false, completedAt=null | 正常 |
| 正常系 | 2回トグル | 2回実行 | 元の状態に戻る | 正常 |

### incrementPomodoros()

| 観点 | テストケース | 入力 | 期待値 | 分類 |
|------|-------------|------|--------|------|
| 正常系 | 0から増加 | actualPomodoros=0 | actualPomodoros=1 | 正常 |
| 正常系 | 複数回増加 | 5回実行 | actualPomodoros=5 | 正常 |
| 境界値 | 見積もり超過 | estimated=3, 4回実行 | actualPomodoros=4 | 境界値 |

### toJSON() / fromJSON()

| 観点 | テストケース | 入力 | 期待値 | 分類 |
|------|-------------|------|--------|------|
| 正常系 | シリアライズ→デシリアライズ | Taskインスタンス | 同一データのTask | 正常 |
| 正常系 | 完了タスク | completed=true | completedAt保持 | 正常 |
| 異常系 | 不正なJSON | 不完全なデータ | エラーまたはデフォルト値 | 異常 |

---

## Timerクラス

### start(taskId)

| 観点 | テストケース | 入力 | 期待値 | 分類 |
|------|-------------|------|--------|------|
| 正常系 | 停止状態から開始 | taskId="uuid-1" | isRunning=true, intervalId設定 | 正常 |
| 正常系 | 実行中に再実行 | 実行中に再度start | 何も起きない（早期リターン） | 正常 |
| 境界値 | taskId=null | null | currentTaskId=null | 境界値 |
| 異常系 | taskId=undefined | undefined | currentTaskId=undefined | 異常 |

### pause()

| 観点 | テストケース | 入力 | 期待値 | 分類 |
|------|-------------|------|--------|------|
| 正常系 | 実行中を停止 | isRunning=true | isRunning=false, interval解除 | 正常 |
| 正常系 | 停止中に停止 | isRunning=false | 何も起きない | 正常 |

### reset()

| 観点 | テストケース | 入力 | 期待値 | 分類 |
|------|-------------|------|--------|------|
| 正常系 | 実行中をリセット | - | remainingSeconds=totalSeconds | 正常 |
| 正常系 | 停止中をリセット | - | remainingSeconds=totalSeconds | 正常 |

### skip()

| 観点 | テストケース | 入力 | 期待値 | 分類 |
|------|-------------|------|--------|------|
| 正常系 | 作業→休憩 | mode='work' | mode='break' | 正常 |
| 正常系 | 休憩→作業 | mode='break' | mode='work' | 正常 |

### setMode(mode)

| 観点 | テストケース | 入力 | 期待値 | 分類 |
|------|-------------|------|--------|------|
| 正常系 | 作業モード | 'work' | totalSeconds=1500 | 正常 |
| 正常系 | 休憩モード（短） | 'break', count=1 | totalSeconds=300 | 正常 |
| 正常系 | 休憩モード（長） | 'break', count=4 | totalSeconds=900 | 正常 |
| 境界値 | ポモドーロカウント3 | count=3 | 短い休憩 | 境界値 |
| 境界値 | ポモドーロカウント4 | count=4 | 長い休憩 | 境界値 |
| 境界値 | ポモドーロカウント5 | count=5 | 短い休憩 | 境界値 |

### tick()

| 観点 | テストケース | 入力 | 期待値 | 分類 |
|------|-------------|------|--------|------|
| 正常系 | 1秒経過 | - | remainingSecondsが1減少 | 正常 |
| 正常系 | タイマー完了 | remainingSeconds=0 | onComplete呼び出し | 正常 |
| 境界値 | remainingSeconds=1 | - | onComplete呼び出し | 境界値 |

### getProgress()

| 観点 | テストケース | 入力 | 期待値 | 分類 |
|------|-------------|------|--------|------|
| 正常系 | 0% | remaining=total | 0 | 正常 |
| 正常系 | 50% | remaining=total/2 | 50 | 正常 |
| 正常系 | 100% | remaining=0 | 100 | 正常 |
| 境界値 | 1秒経過 | remaining=total-1 | 約0.067% (1500秒の場合) | 境界値 |

---

## Statisticsクラス

### addPomodoro()

| 観点 | テストケース | 入力 | 期待値 | 分類 |
|------|-------------|------|--------|------|
| 正常系 | 初回追加 | todayPomodoros=0 | todayPomodoros=1 | 正常 |
| 正常系 | 複数回追加 | 5回実行 | todayPomodoros=5 | 正常 |
| 正常系 | タイムスタンプ記録 | - | pomodoroTimestamps配列に追加 | 正常 |

### addCompletedTask()

| 観点 | テストケース | 入力 | 期待値 | 分類 |
|------|-------------|------|--------|------|
| 正常系 | 初回追加 | todayCompletedTasks=0 | todayCompletedTasks=1 | 正常 |
| 正常系 | 複数回追加 | 3回実行 | todayCompletedTasks=3 | 正常 |

### getTotalWorkTime()

| 観点 | テストケース | 入力 | 期待値 | 分類 |
|------|-------------|------|--------|------|
| 正常系 | 0ポモドーロ | todayPomodoros=0 | 0分 | 正常 |
| 正常系 | 1ポモドーロ | todayPomodoros=1 | 25分 | 正常 |
| 正常系 | 5ポモドーロ | todayPomodoros=5 | 125分 | 正常 |
| 境界値 | 100ポモドーロ | todayPomodoros=100 | 2500分 | 境界値 |

### checkDailyReset()

| 観点 | テストケース | 入力 | 期待値 | 分類 |
|------|-------------|------|--------|------|
| 正常系 | 同じ日 | lastResetDate=今日 | リセットなし | 正常 |
| 正常系 | 日付変更 | lastResetDate=昨日 | すべて0にリセット | 正常 |
| 境界値 | 0時ちょうど | 日付境界 | リセット実行 | 境界値 |

---

## StorageManagerクラス

### save(key, data)

| 観点 | テストケース | 入力 | 期待値 | 分類 |
|------|-------------|------|--------|------|
| 正常系 | 通常の保存 | key, data | localStorage保存成功 | 正常 |
| 正常系 | オブジェクト保存 | key, {a:1} | JSON形式で保存 | 正常 |
| 異常系 | QuotaExceeded | 大量データ | E005エラー表示 | 異常 |
| 異常系 | localStorage無効 | - | E006エラー表示 | 異常 |
| 異常系 | null保存 | key, null | "null"として保存 | 異常 |
| 異常系 | undefined保存 | key, undefined | エラーまたは"undefined" | 異常 |

### load(key, defaultValue)

| 観点 | テストケース | 入力 | 期待値 | 分類 |
|------|-------------|------|--------|------|
| 正常系 | 存在するキー | 保存済みkey | データ取得成功 | 正常 |
| 正常系 | 存在しないキー | 未保存key | defaultValue返却 | 正常 |
| 境界値 | defaultValue=null | key, null | null返却 | 境界値 |
| 異常系 | 不正なJSON | 壊れたJSON文字列 | defaultValue返却 | 異常 |
| 異常系 | localStorage読み込みエラー | - | defaultValue返却 | 異常 |

### saveTasks(tasks) / loadTasks()

| 観点 | テストケース | 入力 | 期待値 | 分類 |
|------|-------------|------|--------|------|
| 正常系 | 空配列 | [] | []が保存・読み込み | 正常 |
| 正常系 | 1タスク | [Task1] | 同一データ取得 | 正常 |
| 正常系 | 複数タスク | [Task1, Task2, ...] | 同一データ取得 | 正常 |
| 境界値 | 100タスク | 100個の配列 | すべて保存・読み込み | 境界値 |
| 境界値 | 1000タスク | 1000個の配列 | すべて保存・読み込み | 境界値 |
| 異常系 | 不正なデータ | 壊れたタスクデータ | 空配列またはエラー | 異常 |

### saveTimer(timer) / loadTimer()

| 観点 | テストケース | 入力 | 期待値 | 分類 |
|------|-------------|------|--------|------|
| 正常系 | 初期状態 | 新規Timer | 同一状態取得 | 正常 |
| 正常系 | 実行中状態 | isRunning=true | isRunningは復元されない（仕様） | 正常 |
| 正常系 | データなし | - | 新規Timerインスタンス | 正常 |

### saveStatistics(stats) / loadStatistics()

| 観点 | テストケース | 入力 | 期待値 | 分類 |
|------|-------------|------|--------|------|
| 正常系 | 通常の統計 | Statistics | 同一データ取得 | 正常 |
| 正常系 | データなし | - | 新規Statisticsインスタンス | 正常 |
| 正常系 | 日付リセットチェック | 昨日のデータ | リセット後の新規データ | 正常 |

---

## TodoControllerクラス

### addTask(title, estimatedPomodoros)

| 観点 | テストケース | 入力 | 期待値 | 分類 |
|------|-------------|------|--------|------|
| 正常系 | 通常のタスク | "タスク1", 5 | true, タスク追加 | 正常 |
| 正常系 | 見積もりなし | "タスク1", 0 | true, estimated=0 | 正常 |
| 境界値 | 1文字 | "a", 0 | true, タスク追加 | 境界値 |
| 境界値 | 100文字 | 100文字の文字列 | true, タスク追加 | 境界値 |
| 境界値 | 空白のみ | "   ", 0 | false, E001エラー | 境界値 |
| 異常系 | 空文字 | "", 0 | false, E001エラー | 異常 |
| 異常系 | 101文字 | 101文字の文字列 | false, E002エラー | 異常 |
| 異常系 | null | null, 0 | false, エラー | 異常 |
| 異常系 | undefined | undefined, 0 | false, エラー | 異常 |

### editTask(id, newTitle)

| 観点 | テストケース | 入力 | 期待値 | 分類 |
|------|-------------|------|--------|------|
| 正常系 | 通常の編集 | id, "新タイトル" | true, タイトル変更 | 正常 |
| 正常系 | 前後の空白削除 | id, "  タイトル  " | true, "タイトル" | 正常 |
| 境界値 | 1文字 | id, "a" | true, タイトル変更 | 境界値 |
| 境界値 | 100文字 | id, 100文字 | true, タイトル変更 | 境界値 |
| 異常系 | 存在しないID | "invalid-id", "新" | false | 異常 |
| 異常系 | 空文字 | id, "" | false, E001エラー | 異常 |
| 異常系 | 101文字 | id, 101文字 | false, E002エラー | 異常 |
| 異常系 | 空白のみ | id, "   " | false, E001エラー | 異常 |

### deleteTask(id)

| 観点 | テストケース | 入力 | 期待値 | 分類 |
|------|-------------|------|--------|------|
| 正常系 | 通常の削除 | id | true, タスク削除 | 正常 |
| 正常系 | 選択中タスク削除 | selectedTaskId | selectedTaskId=null | 正常 |
| 異常系 | タイマー実行中 | タイマー中のtaskId | false, E004エラー | 異常 |
| 異常系 | 存在しないID | "invalid-id" | true（何も起きない） | 異常 |

### toggleTaskComplete(id)

| 観点 | テストケース | 入力 | 期待値 | 分類 |
|------|-------------|------|--------|------|
| 正常系 | 未完了→完了 | id | completed=true, 統計+1 | 正常 |
| 正常系 | 完了→未完了 | id | completed=false, 統計-1 | 正常 |
| 境界値 | 統計0で-1 | completed→uncompleted | 統計=0（負にならない） | 境界値 |

### selectTask(id)

| 観点 | テストケース | 入力 | 期待値 | 分類 |
|------|-------------|------|--------|------|
| 正常系 | 通常の選択 | id | selectedTaskId=id | 正常 |
| 異常系 | タイマー実行中 | タイマー中にid | エラー、選択不可 | 異常 |

### getFilteredTasks()

| 観点 | テストケース | 入力 | 期待値 | 分類 |
|------|-------------|------|--------|------|
| 正常系 | フィルタ='all' | - | すべてのタスク | 正常 |
| 正常系 | フィルタ='active' | - | 未完了のみ | 正常 |
| 正常系 | フィルタ='completed' | - | 完了済みのみ | 正常 |
| 境界値 | タスク0件 | フィルタ適用 | 空配列 | 境界値 |
| 異常系 | 不正なフィルタ | 'invalid' | すべてのタスク（デフォルト） | 異常 |

---

## TimerControllerクラス

### handleStart()

| 観点 | テストケース | 入力 | 期待値 | 分類 |
|------|-------------|------|--------|------|
| 正常系 | タスク選択済み | selectedTaskId設定済み | タイマー開始 | 正常 |
| 異常系 | タスク未選択 | selectedTaskId=null | E003エラー | 異常 |

### handlePause()

| 観点 | テストケース | 入力 | 期待値 | 分類 |
|------|-------------|------|--------|------|
| 正常系 | 実行中を一時停止 | isRunning=true | isRunning=false | 正常 |
| 正常系 | タイマー状態保存 | - | StorageManager.saveTimer呼び出し | 正常 |

### handleReset()

| 観点 | テストケース | 入力 | 期待値 | 分類 |
|------|-------------|------|--------|------|
| 正常系 | リセット確認→OK | - | タイマーリセット | 正常 |
| 正常系 | リセット確認→キャンセル | - | 何も起きない | 正常 |

### handleTimerComplete()

| 観点 | テストケース | 入力 | 期待値 | 分類 |
|------|-------------|------|--------|------|
| 正常系 | 作業完了 | mode='work' | ポモドーロ+1, 通知 | 正常 |
| 正常系 | 休憩完了 | mode='break' | 通知のみ | 正常 |
| 正常系 | 自動休憩開始 | autoStart=true | 休憩モードに切替 | 正常 |

---

## エラーメッセージ検証

| エラーコード | トリガー条件 | 期待メッセージ |
|------------|------------|--------------|
| E001 | 空のタスク名 | "タスク名を入力してください" |
| E002 | 101文字以上 | "タスク名は100文字以内で入力してください" |
| E003 | タスク未選択でタイマー開始 | "タスクを選択してください" |
| E004 | タイマー実行中にタスク削除 | "タイマーを停止してから削除してください" |
| E005 | LocalStorage容量超過 | "保存容量が不足しています" |
| E006 | LocalStorage保存失敗 | "データの保存ができません" |
| E007 | リセット確認 | "タイマーをリセットしますか？" |
| E008 | 編集中に他操作 | "編集を完了してください" |

---

## カバレッジ目標

- **分岐網羅率**: 100%
- **行カバレッジ**: 95%以上
- **関数カバレッジ**: 100%

## テスト実行要件

1. すべての正常系テストが成功すること
2. すべての異常系テストが適切にエラーハンドリングされること
3. 境界値テストがすべて成功すること
4. エラーメッセージが正しく表示されること
5. Given/When/Then形式のコメントが各テストに付与されていること
