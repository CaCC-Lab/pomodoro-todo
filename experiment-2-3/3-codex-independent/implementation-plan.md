# PomoTodo 実装計画（Codex）

## タスク分類・方針
- 分類: 🟡 標準タスク（複数ファイル改修 + 新規機能セット）
- 技術スタック固定: HTML5 / CSS3 / Vanilla JS ES6+、ビルドツール・フレームワーク禁止
- 優先順位: 必須要件 → 高優先度追加要件 → 準拠非機能要件（性能/UX/アクセシビリティ）
- 成功条件: LocalStorage永続化を備えたTodo × ポモドーロ統合、通知、統計、UI/UX要件の充足

## 進行状況トラッカー
`[⬜⬜⬜⬜⬜⬜⬜⬜⬜⬜]` 未着手 → フェーズ毎に埋めて進捗を可視化。

## 実装チェックリスト（フェーズ別）

### フェーズ0: プロジェクト初期化 & 基本構造
- [✅️] `index.html` の骨組み作成（セマンティックレイアウト: header / main / aside / section）
- [✅️] `style.css` 初期セット: CSSカスタムプロパティ、リセット、タイポグラフィ、ライト/ダークモード
- [✅️] `app.js` ベースモジュール構成（即時関数 or モジュールパターンでグローバル汚染を最小化）
- [✅️] ユーティリティ: `qs/ce`ヘルパー、フォーマット関数（mm:ss、日付）
- [✅️] パフォーマンス監視用の軽量ロガー（devフラグで切替）

### フェーズ1: データモデル & ストレージ層
- [✅️] Task/Timer/Settings/History モデル定義（デフォルト値、型バリデーション）
- [✅️] ID生成（timestamp + random）とISO日時ユーティリティ
- [✅️] LocalStorageラッパ（try/catch、容量/権限エラー処理 E005/E006）
- [✅️] 初期データロード & マイグレーション（キー存在チェック、旧データ整形）
- [✅️] `pomotodo_today` と履歴ローテーション（30日分）

### フェーズ2: Todo入力フォーム & バリデーション
- [✅️] 入力フォーム（タスク名 + 見積もり）とエラーメッセージ領域
- [✅️] バリデーション: 必須/最大100文字/数値範囲1-20、リアルタイム検証
- [✅️] Enterキー送信、追加後のフォームリセット & フォーカス復帰
- [✅️] エラーコード（E001/E002）に基づくUI

### フェーズ3: タスク一覧レンダリング & CRUD
- [✅️] タスクリストコンポーネント（未完了→完了の並び、追加時フェードイン class）
- [✅️] チェックボックス → 完了状態遷移、完了タスク下部移動、strike-through
- [✅️] 実績/見積もり表示（`🍅 actual/estimated` + 色分け）
- [✅️] 編集モード（ダブルクリック→インライン編集、Enter確定/Escキャンセル、E008ハンドリング）
- [✅️] 削除ボタン（✕アイコン、タイマー実行中ブロック E004 + フェードアウト）
- [✅️] 選択状態管理（クリックでハイライト、タイマー実行中は選択不可メッセージ）
- [✅️] リストの仮想DOMまたは最小再描画戦略で100件でも滑らかに

### フェーズ4: フィルタリング & 状態保持
- [✅️] フィルタボタン群（全て/未完了/完了）+ アクティブスタイル
- [✅️] フィルタロジック（in-memory filter → レンダリング）
- [✅️] フィルタ変更アニメーション（トランジション or fade）
- [✅️] フィルタ状態をSettings.filterStateとしてLocalStorage保存/復元

### フェーズ5: タイマーエンジン & 表示
- [✅️] 状態マシン設計（`work|shortBreak|longBreak|idle`）と遷移テーブル
- [✅️] setInterval + 実時間比較によるドリフト補正（±1秒要件）
- [✅️] タイマーUI（モード表示、MM:SS、円形 or 線形プログレス、現在タスク名）
- [✅️] コントロール群（開始/一時停止/再開/リセット/スキップ）とボタン状態制御
- [✅️] タスク未選択時のE003表示、リセットダイアログ（E007）
- [✅️] Audio/Notification API実装（許可チェック、フォールバック音）
- [✅️] タイマー状態LocalStorage保存（残り時間、開始時刻、実行中フラグ）& 復元

### フェーズ6: タスク連携 & ポモドーロカウント
- [✅️] タイマー開始時にcurrentTaskIdを固定、実行中タスク以外操作をロック
- [✅️] タイマー完了時処理: actualPomodoros++, 今日の計上、長休憩インターバル管理
- [✅️] タスク完了とポモドーロ進捗バー更新（色分岐: 未達/達成/超過）
- [✅️] 今日のサマリー（`Today: 🍅 n`, 完了タスク数, 総時間）リアルタイム更新

### フェーズ7: 設定・追加機能
- [✅️] 設定パネル（モーダル or スライドパネル）: 各時間、長休憩間隔、通知音、focus mode
- [✅️] 入力バリデーション（1-60分、longBreakInterval 1-10）と即時反映
- [✅️] フォーカスモード: UI簡素化/背景暗転/通知抑制
- [✅️] 設定値の保存・ロード、デフォルトに戻すオプション

### フェーズ8: UI/UX ポリッシュ & アクセシビリティ
- [✅️] レイアウトブレークポイント: Desktop 40/60 split, Tablet 45/55, Mobile タブ切替
- [✅️] CSSアニメーション（タスク追加、フィルタ切り替え、ボタンhover）
- [✅️] フォーカスリング、ARIA属性（role, aria-live=polite forタイマー等）
- [✅️] キーボード操作: Tab順序、Spaceでチェック、Enterで主要操作、Escでモーダル閉鎖
- [✅️] 色コントラストとカラーモード（prefers-color-scheme）対応

### フェーズ9: 永続化シナリオ & エラーハンドリング
- [✅️] LocalStorage書き込みごとのtry/catch（E005/E006）→ UIトースト表示
- [✅️] データ破損時のフェイルセーフ（初期化確認ダイアログ）
- [✅️] 自動バックアップ（前回データを`pomotodo_tasks_backup`に保持）
- [✅️] 履歴データ（`pomotodo_history`）の記録と古い日の削除

### フェーズ10: テスト & 検証
- [✅️] 単体テスト相当: コア関数（ID生成、検証、タイマー補正）を手動/コンソールで確認
- [✅️] シナリオテスト: タスクCRUD、タイマー遷移、設定変更、フィルタ持続
- [✅️] アクセシビリティクイックチェック（キーボード、スクリーンリーダー読み上げ）
- [✅️] パフォーマンステスト: 100タスク状態で操作レスポンス計測
- [✅️] クロスブラウザ（Chrome/Safari/Firefox/Edge最新版）軽検証

## リスクと対策
- タイマー精度劣化 → 実時間差分方式 + タブ復帰時再同期
- LocalStorage満杯/無効 → ユーザー通知 + 古い履歴削除ガイド
- タスク編集中の操作衝突 → 編集ロックフラグで他操作ブロック
- 通知許可拒否 → 視覚/音声フォールバック

## 完了基準
- チェックリスト全項目 `✅` + 付録Cチェックリストの必須要件網羅
- E2E操作デモ（新規タスク→タイマー→統計）がエラーなしで完遂
- コード品質: 関数単一責任、コメント最小限、グローバル2個以下
